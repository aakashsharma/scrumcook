<% title @project.name.camelcase %>
<%= render :partial => 'control_panel', :locals => {:current_project => @project} %>
<div id="all_panels" class="story_content">
  <table id="layout" class="layout" cellspacing="16px">
    <tbody>
    <tr>

      <% WorkableItem.categories.each do |category| %>
          <% workable_items_in_category = @project.workable_items.select { |wi| wi.category == category } %>
          <% if !workable_items_in_category.present?
                 category_display_class = 'display:none'
             end
             if category.eql?('icebox')
                 category_display_class = "";
             end %>
          <td id="<%= category %>" class="<%= "#{category} panel" %>" style="<%= category_display_class %>" width="25%">
            <div class="panelHeaderRight"></div>
            <div class="panelHeaderLeft"></div>
            <div class="panelHeader">
              <div id=<%= "#{category}_title" %>>
                <a href="#" class="closePanel panelLink" id='<%= "#{category}_close" %>' title="Close panel"></a>
                <span class="panelTitle"><%= category.upcase %> </span>
                <span class="external_icon"></span>
            <span class="panelSubtitle">
              displaying last 12 iterations (<a href="#" class=<%= "show#{category.capitalize}StoriesLink" %>>show
              all</a>)
            </span>
              </div>
            </div>
            <div id="<%= "#{category}_item_list" %>" class="list">
              <div class="btm">
                <div class="right"></div>
                <div class="left"></div>
                <div class="mid"></div>
              </div>
              <div id="<%= "#{category}_items" %>" class="items">
                <div id="<%= "#{category}_scrolling_item_list" %>" class="inner scrolling_item_list">
                  <% if category.eql?('icebox') %>
                      <%
                         @workable_item = WorkableItem.new
                         @workable_item.project = @project
                         @workable_item.requester = current_user.id
                      %>
                      <%= render :partial => 'workable_items/workable_item_detail', :locals => {:workable_item => @workable_item} %>
                  <% end %>
                  <% if workable_items_in_category.present? %>
                      <%= render :partial => 'workable_items/workable_items_collection',
                                 :locals => {:workable_items => @project.workable_items.select { |wi| wi.category == category }} %>
                  <% else %>
                      <% if category.eql?('icebox') and !@project.workable_items.present? %>
                          <div id="no_workable_items" class="no_workable_items">
                            You have not got any work to do in this project yet. Hurry, and start working!!
                          </div>
                      <% end %>
                  <% end %>

                </div>
                <div id="<%= "#{category}_itemList_endOfList" %>" class="endOfList"></div>
              </div>
            </div>
          </td>
      <% end %>
    </tr>
    </tbody>
  </table>
</div>

<script type="text/javascript">
    estimate_bugs = <%= @project.estimate_bugs? %>;
    estimate_chores = <%= @project.estimate_chores? %>;
</script>